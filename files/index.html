<!doctype html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Giving Day</title>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/motion-ui/1.2.3/motion-ui.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation-prototype.min.css">
<link rel="stylesheet" href='//cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css'>
<link rel="stylesheet" href="/style.css">

</head>
<body>


<div class="top-bar">
<div class="top-bar-left">
<ul class="menu">
<li><a href="http://brifishjones.com">brifishjones.com</a></li>
<li><a href="https://socket.io">socket.IO</a></li>
<li><a href="http://brifishjones.com/giving-day-socketio">Blog</a></li>
</ul>
</div>
</div>

<div class="callout large primary">
<div class="text-center">
<h1>Giving Day</h1>
<h2 class="subheader">Demo of socket.IO</h2>
</div>
</div>
<article class="grid-container">
<div class="grid-x align-center">
<div class="cell medium-8">
<div class="blog-post">
<h4 style="text-align: center;">Total Raised</h4>
<p class="money-raised" style="text-align: center;">$15,000</p>
<p>For this demo the socket.IO server will update the <i>Total Raised</i> and <i>Young Alumni Challenge</i> every 15 seconds.</p>
<p><strong>Parents Council Challenge</strong> - Dollar-for-dollar match up to $12,250 (8 am - 12 am)</p>
<div id="parents-council" class="success progress" role="progressbar" tabindex="0" aria-valuenow="100" aria-valuemin="0" aria-valuetext="100 percent" aria-valuemax="100">
  <span class="progress-meter" style="width: 100%">
    <p class="progress-meter-text">Challenge complete!</p>
  </span>
</div>
<p><strong>Young Alumni Challenge</strong> - Gifts from 1000 alumni who've graduated in the last 10 years unlock $23,000 (All Day)</p>
<div id="young-alumni" class="progress" role="progressbar" tabindex="0" aria-valuenow="10" aria-valuemin="0" aria-valuetext="10 percent" aria-valuemax="100">
  <span class="progress-meter" style="width: 10%">
    <p class="progress-meter-text">100</p>
  </span>
</div>

</div>
</div>
</div>
</article>
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/js/foundation.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/motion-ui/1.2.3/motion-ui.min.js"></script>
<script src="/socket.io.js"></script>
<script>
  $(document).foundation();
</script>
<script>
  var socket = io('192.168.56.105' + ':4443', {secure: true});
  socket.on('update-totals', function (data) {
  	document.getElementsByClassName("money-raised")[0].innerHTML = "$" + data.total.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  });
 	socket.on('update-challenges', function (data) {
    console.log(data)
    for (var key in data) {
      var donors = data[key]['donors'];
      var percent_complete = donors * 100.0 / data[key]['challenge_donors'];
      document.getElementById(key).innerHTML = '<span class="progress-meter" style="width: ' + percent_complete + '%"><p class="progress-meter-text">' + donors + '</p></span>';
    }
  });
</script>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {
    'packages':['geochart'],
    // Note: you will need to get a mapsApiKey for your project.
    // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
    'mapsApiKey': 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
  });
  google.charts.setOnLoadCallback(drawRegionsMap);

  function drawRegionsMap() {

    testData = {"AL":2,"AK":3,"AZ":8,"AR":1,"CA":19,"CO":41,"CT":3,"DE":1,"FL":8,"GA":6,
            "HI":1,"ID":3,"IL":69,"IN":10,"IA":479,"KS":5,"KY":3,"LA":2,"ME":1,"MD":14,
            "MA":2,"MI":7,"MN":370,"MS":1,"MO":6,"MT":5,"NE":5,"NV":1,"NH":1,"NJ":2,
            "NM":3,"NY":9,"NC":12,"ND":6,"OH":8,"OK":1,"OR":3,"PA":4,"RI":3,"SC":2,
            "SD":10,"TN":6,"TX":18,"UT":1,"VT":3,"VA":29,"WA":14,"WV":1,"WI":101,"WY":1}

    states = ["AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DC", "DE", "FL", "GA",
              "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD",
              "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ",
              "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC",
              "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"]

    allStatesLst = [['State', 'Number of donors']];

    for (item in testData) {
      allStatesLst.push([item, testData[item]])
    }

    var data = google.visualization.arrayToDataTable(
      allStatesLst
    );

    var options = {
      width:556,
      height: 347,
      region: "US",
      resolution: "provinces",
      colorAxis: {colors: ["#D3D3D3", "#1a4ea3"]}
    };

    var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

    chart.draw(data, options);
  }
</script>
<div id="regions_div" style="width: 900px; height: 500px;"></div>
</body>
</html>
